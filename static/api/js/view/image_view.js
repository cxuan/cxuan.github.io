window._bd_share_main.F.module("view/image_view",function(e,t,i){var b=e("base/tangram").T,o=e("base/class").Class,s=e("conf/const"),n=e("view/view_base");t.View=o.create(function(m){function o(e){var t,i,o=e.target;t=o,i=!0,m.bdMinHeight&&m.bdMinHeight>t.offsetHeight?i=!1:m.bdMinWidth&&m.bdMinWidth>t.offsetWidth?i=!1:(t.offsetWidth<100||t.offsetHeight<100)&&(i=!1),i&&(f.element=o,f.start())}function n(){f.abort()}var r=this,h="bdimgshare_"+(new Date).getTime(),u=null,t=!1,i=null,f=new function(e){var t=!1,i=!1;this.clearAbort=function(){i&&(i=clearTimeout(i))},this.start=function(){i&&(i=clearTimeout(i)),t||(t=setTimeout(function(){e.startFn&&e.startFn(),t=!1},e.time))},this.abort=function(){t&&(t=clearTimeout(t)),i||(i=setTimeout(function(){e.abortFn&&e.abortFn(),i=!1},e.time))}}({time:200,startFn:function(){var e;(e=f.element)&&function(e){if(m.bdCustomStyle){var t=document.createElement("link");t.href=m.bdCustomStyle,t.rel="styleSheet",t.type="text/css",t.onLoad=function(){e()},document.getElementsByTagName("head")[0].appendChild(t)}else window._bd_share_main.F.use(["imgshare.css","share_style0_"+m.viewSize+".css"],function(){e()})}(function(){(function(e){if("list"==m.viewType)for(var t={16:{lbl:53,pright:8,item:18},24:{lbl:57,pright:8,item:28},32:{lbl:61,pright:8,item:38}}[m.viewSize],i=Math.floor((e.offsetWidth-t.lbl-t.pright-10)/t.item),o=u.find(".bdimgshare-icon"),n=0,s=o.length-1;n<s;n++)n<i-1?b(o[n]).show():b(o[n]).hide();var a,r,h,f={width:u.offsetWidth,height:u.offsetHeight},l={width:e.offsetWidth,height:e.offsetHeight},d=(a=b(e).offset(),r=l,h=f,"list"==m.viewType?{top:a.top+("bottom"==m.viewPos?r.height-h.height:0),left:a.left}:"collection"==m.viewType?{top:a.top+(-1<m.viewPos.toLowerCase().indexOf("bottom")?r.height-h.height-5:5),left:a.left+(-1<m.viewPos.toLowerCase().indexOf("left")?5:r.width-h.width-5)}:{top:a.top+("bottom"==m.viewPos?r.height-h.height:0),left:a.left+(r.width-h.width)}),c={position:"absolute",top:d.top+"px",left:d.left+"px"};"list"==m.viewType&&(c.width=l.width+"px"),u.css(c)})(e),u.show(),t=!1,i=e})},abortFn:function(){t||u.hide()}});r.render=function(e){var i;i=m.tag||"",b("img").each(function(e,t){if(!i||b(t).attr(s.CONFIG_TAG_ATTR)==i){if(1==b(t).attr("data-bd-imgshare-binded"))return;b(t).on("mouseenter",o).on("mouseleave",n),b(t).attr("data-bd-imgshare-binded",1)}}),function(){var e=["<div id='#{id}' class='sr-bdimgshare sr-bdimgshare-#{type} sr-bdimgshare-#{size} sr-bdimgshare-#{color}' style='height:#{height}px;line-height:#{lineHeight}px;font-size:#{fontSize}px;width:#{width}px;display:none;'>","<div class='bdimgshare-bg'></div>","<div class='bdimgshare-content bdsharebuttonbox bdshare-button-style#{style}-#{size}'>","<label class='bdimgshare-lbl'>#{text}</label>","#{list}","</div>","</div>"].join(""),i="<a href='#' onclick='return false;' class='bds_#{icon}' data-cmd='#{icon}' hidefocus></a>",t="list"==m.viewType,o=[];t&&b.each(m.viewList,function(e,t){o.push(b.string(i).format({icon:t}))}),o.push(b.string(i).format({icon:"more"}));var n={16:"36",24:"42",32:"48"},s={16:"33",24:"39",32:"45"},a=b.string(e).format({id:h,text:m.viewText||(t?"图片分享":"分享"),type:m.viewType,style:m.viewStyle,size:m.viewSize,color:m.viewColor,width:t?"auto":{16:"60",24:"71",32:"82"}[m.viewSize],height:(t?n:s)[m.viewSize],lineHeight:(t?n:s)[m.viewSize]-10,fontSize:{16:"12",24:"14",32:"14"}[m.viewSize],list:o.join("")});b("body").insertHTML("beforeEnd",a),r._entities=u=b("#"+h),u.on("mouseleave",function(){f.abort()}).on("mouseenter",function(){f.clearAbort()})}()},r._init=function(){},r._keepBarVisible=function(){f.clearAbort(),t=!0},r._getImageSrc=function(){return i.src},r._distory=function(){u.remove();var i=m.tag||"";b("img").each(function(e,t){i&&b(t).attr(s.CONFIG_TAG_ATTR)!=i||(b(t).off("mouseenter",o).off("mouseleave",n),b(t).removeAttr("data-bd-imgshare-binded"))})}},n.ViewBase)});